<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>UI Configurator — Live Preview</title>

    <style>
      :root {
        --color-primary: #4a78ff;
        --color-secondary: #335bef;
        --color-text: #222222;
        --color-bg: #ffffff;

        --border-radius: 8px;

        --spacing-small: 8px;
        --spacing-medium: 16px;
        --spacing-large: 24px;

        --font-base: 16px;

        --font-size-small: 13px;
        --font-size-medium: 16px;
        --font-size-large: 20px;

        --padding-small: 6px;
        --padding-medium: 10px;
        --padding-large: 14px;

        --panel-bg: #ffffff;
        --muted: #777;
      }

      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, "Segoe UI", Roboto,
          "Helvetica Neue", Arial;
        background: #e8e8e8;
        color: var(--color-text);
      }

      #layout {
        display: grid;
        grid-template-columns: 260px 1fr 260px;
        height: calc(100vh - 80px);
        gap: 12px;
        padding: 12px;
      }

      #sidebar-left,
      #sidebar-right,
      #center-preview {
        background: var(--panel-bg);
        border-radius: 12px;
        padding: 16px;
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        overflow-y: auto;
      }

      header {
        background: var(--panel-bg);
        padding: 16px 24px;
        margin-bottom: 12px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        border-radius: 0 0 12px 12px;
      }
      header h1 {
        margin: 0;
        font-size: 18px;
      }

      details {
        margin-bottom: 16px;
        padding: 8px 12px;
        border: 2px solid #ccc;
        border-radius: 8px;
        background: var(--panel-bg);
      }

      summary {
        font-weight: bold;
        cursor: pointer;
        padding-left: 24px;
        display: block;
        position: relative;
        margin-bottom: 16px;
      }

      summary::before {
        content: "";
        width: 0;
        height: 0;
        border-style: solid;
        border-width: 6px 0 6px 4px;
        border-color: transparent transparent transparent var(--color-text);
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        transition: transform 0.2s ease;
      }

      details[open] summary::before {
        transform: translateY(-50%) rotate(90deg);
      }

      #preview-area {
        flex: 1;
        border: 2px dashed #ccc;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--panel-bg);
        min-height: 200px;
        font-size: 18px;
        color: var(--muted);
        padding: 20px;
      }

      .prop-group,
      .comp-group,
      .token-group {
        margin-bottom: 16px;
        display: flex;
        flex-direction: column;
      }

      #sidebar-left label,
      #sidebar-right label {
        font-size: 14px;
        font-weight: normal;
        margin-bottom: 6px;
        color: #222;
      }

      #sidebar-left input[type="text"],
      #sidebar-left select,
      #sidebar-right input[type="text"],
      #sidebar-right select {
        padding: 8px;
        border-radius: 6px;
        border: 1px solid #ccc;
        width: 100%;
        background: #fff;
        font-size: 14px;
      }

      #sidebar-left input[type="color"],
      #sidebar-left input[type="range"],
      #sidebar-right input[type="color"],
      #sidebar-right input[type="range"] {
        margin-top: 0;
        margin-bottom: 0;
      }

      input[type="range"] {
        width: 100%;
      }

      .value-display {
        font-size: 12px;
        color: #555;
        margin-top: 4px;
      }

      #sidebar-right button {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        border: none;
        border-radius: 8px;
        background: var(--color-primary);
        color: white;
        font-size: 15px;
        cursor: pointer;
        transition: background 0.18s ease, transform 0.08s ease;
      }
      #sidebar-right button:hover {
        background: var(--color-secondary);
      }
      #sidebar-right button:active {
        transform: translateY(0);
      }

      .preview-component {
        --component-bg: unset;
        --component-text: unset;
        --component-border-radius: unset;

        background: var(--component-bg);
        color: var(--component-text, var(--token-text));
        border-radius: var(
          --component-border-radius,
          var(--token-border-radius)
        );
        font-size: calc(var(--font-size-base) + var(--font-size-adjust, 0px));
        padding: calc(var(--padding-y-base) + var(--padding-adjust, 0px))
          calc(var(--padding-x-base) + var(--padding-adjust, 0px));
      }

      .preview-button {
        border: none;
        cursor: pointer;
        box-shadow: 0 6px 18px rgba(34, 34, 34, 0.06);
      }

      .preview-button.primary {
        background: var(--component-bg, var(--token-primary));
        color: var(--component-text, var(--token-text));
      }

      .preview-button.secondary {
        background: var(--component-bg, var(--token-secondary));
        color: var(--component-text, var(--token-text));
      }

      .preview-button.outlined {
        background: transparent;
        color: var(--component-text, var(--token-primary));
        border: 1px solid var(--token-primary);
      }

      .preview-button.size-small {
        --font-size-base: 13px;
        --padding-y-base: 6px;
        --padding-x-base: 10px;
      }

      .preview-button.size-medium {
        --font-size-base: 16px;
        --padding-y-base: 10px;
        --padding-x-base: 14px;
      }

      .preview-button.size-large {
        --font-size-base: 20px;
        --padding-y-base: 14px;
        --padding-x-base: 20px;
      }

      .preview-card {
        max-width: 460px;
        width: 100%;
        border: 1px solid rgba(0, 0, 0, 0.04);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        transition: box-shadow 0.14s ease;
      }

      .preview-card.primary {
        background: var(--component-bg, var(--token-primary));
        color: var(--component-text, var(--token-text));
      }

      .preview-card.secondary {
        background: var(--component-bg, var(--token-secondary));
        color: var(--component-text, var(--token-text));
      }

      .preview-card.outlined {
        background: transparent;
        color: var(--component-text, var(--token-primary));
        border: 1px solid var(--token-primary);
      }

      .preview-card.size-small {
        --font-size-base: 14px;
        --padding-y-base: 8px;
        --padding-x-base: 8px;
      }

      .preview-card.size-medium {
        --font-size-base: 16px;
        --padding-y-base: 16px;
        --padding-x-base: 16px;
      }

      .preview-card.size-large {
        --font-size-base: 18px;
        --padding-y-base: 24px;
        --padding-x-base: 24px;
      }

      .preview-header {
        display: block;
        width: 100%;
        text-align: center;
        font-weight: 700;
      }

      .preview-header.primary {
        background: var(--component-bg, var(--token-primary));
        color: var(--component-text, var(--token-text));
      }

      .preview-header.secondary {
        background: var(--component-bg, var(--token-secondary));
        color: var(--component-text, var(--token-text));
      }

      .preview-header.outlined {
        background: transparent;
        color: var(--component-text, var(--token-primary));
        border: 1px solid var(--token-primary);
      }

      .preview-header.size-small {
        --font-size-base: 16px;
        --padding-y-base: 8px;
        --padding-x-base: 12px;
      }

      .preview-header.size-medium {
        --font-size-base: 20px;
        --padding-y-base: 12px;
        --padding-x-base: 16px;
      }

      .preview-header.size-large {
        --font-size-base: 26px;
        --padding-y-base: 16px;
        --padding-x-base: 20px;
      }

      .anim-hover-scale {
        transition: transform 350ms ease;
      }
      .anim-hover-scale:hover {
        transform: scale(1.04);
      }

      .anim-hover-fade {
        transition: opacity 350ms ease;
      }
      .anim-hover-fade:hover {
        opacity: 0.85;
      }

      .anim-hover-lift {
        transition: transform 350ms ease, box-shadow 350ms ease;
      }
      .anim-hover-lift:hover {
        transform: translateY(-4px);
        box-shadow: 0 10px 26px rgba(0, 0, 0, 0.12);
      }

      .anim-press-scale {
        transition: transform 200ms ease;
      }
      .anim-press-scale:active {
        transform: scale(0.97);
      }

      button:focus,
      input:focus,
      select:focus,
      a:focus {
        outline: 3px solid rgba(74, 120, 255, 0.18);
        outline-offset: 2px;
      }

      @media (max-width: 800px) {
        #layout {
          grid-template-columns: 1fr;
          grid-auto-rows: min-content;
          height: auto;
          gap: 10px;
          padding: 8px;
        }

        #sidebar-left,
        #center-preview,
        #sidebar-right {
          padding: 12px;
          border-radius: 10px;
          box-shadow: 0 4px 10px rgba(0, 0, 0, 0.06);
        }

        header {
          padding: 12px 16px;
        }
        header h1 {
          font-size: 16px;
        }

        details {
          padding: 6px 10px;
        }

        #preview-area {
          min-height: 160px;
          padding: 12px;
          font-size: 16px;
        }

        #sidebar-left label,
        #sidebar-right label {
          font-size: 13px;
        }

        #sidebar-left input[type="text"],
        #sidebar-left select,
        #sidebar-right input[type="text"],
        #sidebar-right select {
          font-size: 14px;
        }

        .value-display {
          font-size: 11px;
        }

        #sidebar-right button {
          padding: 8px;
          font-size: 14px;
          margin-bottom: 8px;
        }

        .preview-button.size-small {
          --font-size-base: 12px;
          --padding-y-base: 6px;
          --padding-x-base: 10px;
        }

        .preview-button.size-medium {
          --font-size-base: 14px;
          --padding-y-base: 8px;
          --padding-x-base: 12px;
        }

        .preview-button.size-large {
          --font-size-base: 16px;
          --padding-y-base: 10px;
          --padding-x-base: 14px;
        }

        .preview-card.size-small {
          --font-size-base: 13px;
          --padding-y-base: 6px;
          --padding-x-base: 8px;
        }

        .preview-card.size-medium {
          --font-size-base: 14px;
          --padding-y-base: 12px;
          --padding-x-base: 12px;
        }

        .preview-card.size-large {
          --font-size-base: 16px;
          --padding-y-base: 18px;
          --padding-x-base: 18px;
        }

        .preview-header.size-small {
          --font-size-base: 15px;
          --padding-y-base: 8px;
          --padding-x-base: 10px;
        }

        .preview-header.size-medium {
          --font-size-base: 17px;
          --padding-y-base: 10px;
          --padding-x-base: 12px;
        }

        .preview-header.size-large {
          --font-size-base: 20px;
          --padding-y-base: 12px;
          --padding-x-base: 14px;
        }

        .preview-nav {
          gap: 10px;
          flex-wrap: wrap;
        }

        :root {
          --spacing-small: 6px;
          --spacing-medium: 12px;
        }
      }

      @media (max-width: 420px) {
        #layout {
          padding: 6px;
          gap: 8px;
        }

        header h1 {
          font-size: 15px;
        }

        #preview-area {
          min-height: 140px;
          padding: 10px;
          font-size: 15px;
        }

        #sidebar-left input[type="text"],
        #sidebar-left select,
        #sidebar-right input[type="text"],
        #sidebar-right select {
          font-size: 13px;
        }

        #sidebar-right button {
          padding: 7px;
          font-size: 13px;
        }

        .preview-button.size-small {
          --font-size-base: 11px;
          --padding-y-base: 5px;
          --padding-x-base: 8px;
        }

        .preview-button.size-medium {
          --font-size-base: 13px;
          --padding-y-base: 6px;
          --padding-x-base: 10px;
        }

        .preview-button.size-large {
          --font-size-base: 15px;
          --padding-y-base: 8px;
          --padding-x-base: 12px;
        }

        .preview-card.size-small {
          --font-size-base: 12px;
          --padding-y-base: 6px;
          --padding-x-base: 6px;
        }

        .preview-card.size-medium {
          --font-size-base: 13px;
          --padding-y-base: 10px;
          --padding-x-base: 10px;
        }

        .preview-card.size-large {
          --font-size-base: 15px;
          --padding-y-base: 14px;
          --padding-x-base: 14px;
        }

        .preview-header.size-small {
          --font-size-base: 14px;
          --padding-y-base: 7px;
          --padding-x-base: 8px;
        }

        .preview-header.size-medium {
          --font-size-base: 15px;
          --padding-y-base: 8px;
          --padding-x-base: 10px;
        }

        .preview-header.size-large {
          --font-size-base: 18px;
          --padding-y-base: 10px;
          --padding-x-base: 12px;
        }

        :root {
          --spacing-small: 5px;
          --spacing-medium: 10px;
        }
      }
    </style>
  </head>
  <body>
    <header><h1>UI Configurator — Live Preview</h1></header>

    <main id="layout">
      <aside id="sidebar-left">
        <h2>Configuration</h2>

        <details>
          <summary>Component</summary>

          <div class="comp-group">
            <label for="component-select">Choose Component</label>
            <select id="component-select">
              <option value="button">Button</option>
              <option value="card">Card</option>
              <option value="header">Header</option>
            </select>
          </div>

          <div class="comp-group">
            <label for="component-variant">Variant / Style</label>
            <select id="component-variant">
              <option value="primary">Primary</option>
              <option value="secondary">Secondary</option>
              <option value="outlined">Outlined</option>
            </select>
          </div>

          <div class="comp-group">
            <label for="component-size">Size</label>
            <select id="component-size">
              <option value="small">Small</option>
              <option value="medium" selected>Medium</option>
              <option value="large">Large</option>
            </select>
          </div>
        </details>

        <details>
          <summary>Properties</summary>

          <div class="prop-group">
            <label for="prop-text">Label Text</label>
            <input
              id="prop-text"
              type="text"
              placeholder="Enter text..."
              value="Enter text..."
            />
          </div>

          <div class="prop-group">
            <label for="prop-font-size">Font Size</label>
            <input
              id="prop-font-size"
              type="range"
              min="8"
              max="48"
              value="16"
            />
            <span class="value-display" id="font-size-value">16px</span>
          </div>

          <div class="prop-group">
            <label for="prop-padding">Padding</label>
            <input id="prop-padding" type="range" min="0" max="80" value="10" />
            <span class="value-display" id="padding-value">10px</span>
          </div>

          <div class="prop-group">
            <label for="prop-radius">Border Radius</label>
            <input id="prop-radius" type="range" min="0" max="80" value="8" />
            <span class="value-display" id="radius-value">8px</span>
          </div>

          <div class="prop-group">
            <label for="prop-font-family">Font Family</label>
            <select id="prop-font-family">
              <option value="system-ui">System UI</option>
              <option value="Arial">Arial</option>
              <option value="Helvetica">Helvetica</option>
              <option value="Verdana">Verdana</option>
              <option value="Tahoma">Tahoma</option>
              <option value="Trebuchet MS">Trebuchet MS</option>
              <option value="Georgia">Georgia</option>
              <option value="Times New Roman">Times New Roman</option>
              <option value="Palatino Linotype">Palatino</option>
              <option value="Courier New">Courier New</option>
              <option value="Lucida Console">Lucida Console</option>
              <option value="Impact">Impact</option>
              <option value="Futura">Futura</option>
              <option value="Gill Sans">Gill Sans</option>
              <option value="Comic Sans MS">Comic Sans MS</option>
            </select>
          </div>

          <div class="prop-group">
            <label for="prop-animation">Animation</label>
            <select id="prop-animation">
              <option value="none">None</option>
              <option value="hover-scale">Hover Scale</option>
              <option value="hover-fade">Hover Fade</option>
              <option value="hover-lift">Hover Lift</option>
              <option value="press-scale">Press Scale</option>
            </select>
          </div>

          <div class="prop-group">
            <label for="prop-bg-color">Background Color</label>
            <input id="prop-bg-color" type="color" value="#4a78ff" />
          </div>

          <div class="prop-group">
            <label for="prop-text-color">Text Color</label>
            <input id="prop-text-color" type="color" value="#ffffff" />
          </div>
        </details>

        <details>
          <summary>Design Tokens</summary>

          <div class="token-group">
            <label for="token-primary-color">Primary Background Color</label>
            <input type="color" id="token-primary-color" value="#4a78ff" />
          </div>

          <div class="token-group">
            <label for="token-secondary-color">Secondary Background Color</label>
            <input type="color" id="token-secondary-color" value="#335bef" />
          </div>

          <div class="token-group">
            <label for="token-text-color">Text Color</label>
            <input type="color" id="token-text-color" value="#222222" />
          </div>

          <div class="token-group">
            <label for="token-border-radius">Border Radius</label>
            <input
              type="range"
              id="token-border-radius"
              min="0"
              max="80"
              value="8"
            />
            <span class="value-display" id="token-border-radius-value"
              >8px</span
            >
          </div>

          <hr style="margin: 12px 0; opacity: 0.3" />

          <div class="token-group">
            <label>Small — Font Size</label>
            <input
              type="range"
              id="token-size-small-font"
              min="8"
              max="48"
              value="13"
            />
            <span class="value-display" id="token-size-small-font-value"
              >13px</span
            >
          </div>

          <div class="token-group">
            <label>Small — Padding</label>
            <input
              type="range"
              id="token-size-small-pad"
              min="0"
              max="80"
              value="6"
            />
            <span class="value-display" id="token-size-small-pad-value"
              >6px</span
            >
          </div>

          <div class="token-group">
            <label>Medium — Font Size</label>
            <input
              type="range"
              id="token-size-medium-font"
              min="8"
              max="48"
              value="16"
            />
            <span class="value-display" id="token-size-medium-font-value"
              >16px</span
            >
          </div>

          <div class="token-group">
            <label>Medium — Padding</label>
            <input
              type="range"
              id="token-size-medium-pad"
              min="0"
              max="80"
              value="10"
            />
            <span class="value-display" id="token-size-medium-pad-value"
              >10px</span
            >
          </div>

          <div class="token-group">
            <label>Large — Font Size</label>
            <input
              type="range"
              id="token-size-large-font"
              min="8"
              max="48"
              value="20"
            />
            <span class="value-display" id="token-size-large-font-value"
              >20px</span
            >
          </div>

          <div class="token-group">
            <label>Large — Padding</label>
            <input
              type="range"
              id="token-size-large-pad"
              min="0"
              max="80"
              value="14"
            />
            <span class="value-display" id="token-size-large-pad-value"
              >14px</span
            >
          </div>
        </details>
      </aside>

      <section id="center-preview">
        <div id="preview-area"></div>
      </section>

      <aside id="sidebar-right">
        <h2>Actions</h2>
        <button id="export-css">Export CSS</button>
        <button id="export-json">Export JSON</button>
        <button id="undo-btn">Undo</button>
        <button id="redo-btn">Redo</button>
        <button id="reset-btn">Reset Properties</button>
        <button id="clearAllBtn">Reset All Settings</button>

        <div
          id="contrast-warning"
          style="color: red; font-size: 13px; margin-top: 10px"
        ></div>
      </aside>
    </main>

    <script>
      (function () {
        const previewArea = document.getElementById("preview-area");

        const compSelect = document.getElementById("component-select");
        const compVariant = document.getElementById("component-variant");
        const compSize = document.getElementById("component-size");

        const propText = document.getElementById("prop-text");
        const propFontSize = document.getElementById("prop-font-size");
        const propPadding = document.getElementById("prop-padding");
        const propRadius = document.getElementById("prop-radius");
        const propFontFamily = document.getElementById("prop-font-family");
        const propAnimation = document.getElementById("prop-animation");
        const propBgColor = document.getElementById("prop-bg-color");
        const propTextColor = document.getElementById("prop-text-color");

        const fontSizeValue = document.getElementById("font-size-value");
        const paddingValue = document.getElementById("padding-value");
        const radiusValue = document.getElementById("radius-value");

        const tokenPrimary = document.getElementById("token-primary-color");
        const tokenSecondary = document.getElementById("token-secondary-color");
        const tokenText = document.getElementById("token-text-color");
        const tokenRadius = document.getElementById("token-border-radius");
        const tokenRadiusValue = document.getElementById(
          "token-border-radius-value"
        );
        const tokenSizeSmallFont = document.getElementById(
          "token-size-small-font"
        );
        const tokenSizeSmallFontValue = document.getElementById(
          "token-size-small-font-value"
        );
        const tokenSizeSmallPad = document.getElementById(
          "token-size-small-pad"
        );
        const tokenSizeSmallPadValue = document.getElementById(
          "token-size-small-pad-value"
        );

        const tokenSizeMediumFont = document.getElementById(
          "token-size-medium-font"
        );
        const tokenSizeMediumFontValue = document.getElementById(
          "token-size-medium-font-value"
        );
        const tokenSizeMediumPad = document.getElementById(
          "token-size-medium-pad"
        );
        const tokenSizeMediumPadValue = document.getElementById(
          "token-size-medium-pad-value"
        );

        const tokenSizeLargeFont = document.getElementById(
          "token-size-large-font"
        );
        const tokenSizeLargeFontValue = document.getElementById(
          "token-size-large-font-value"
        );
        const tokenSizeLargePad = document.getElementById(
          "token-size-large-pad"
        );
        const tokenSizeLargePadValue = document.getElementById(
          "token-size-large-pad-value"
        );

        const exportCSSBtn = document.getElementById("export-css");
        const exportJSONBtn = document.getElementById("export-json");
        const undoBtn = document.getElementById("undo-btn");
        const redoBtn = document.getElementById("redo-btn");
        const resetBtn = document.getElementById("reset-btn");
        const clearAllBtn = document.getElementById("clearAllBtn");

        const px = (v) => v + "px";
        const deepCopy = (o) => JSON.parse(JSON.stringify(o));
        const STORAGE_KEY = "ui-configurator-state-v1";

        function mergeDeep(target, source) {
          for (const key in source) {
            if (
              source[key] &&
              typeof source[key] === "object" &&
              !Array.isArray(source[key])
            ) {
              if (!target[key] || typeof target[key] !== "object") {
                target[key] = {};
              }
              mergeDeep(target[key], source[key]);
            } else {
              target[key] = source[key];
            }
          }
        }

        function saveStateToStorage() {
          try {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
          } catch (err) {
            console.warn("Could not save state to localStorage:", err);
          }
        }

        function loadStateFromStorage() {
          try {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (!raw) return false;
            const parsed = JSON.parse(raw);
            mergeDeep(state, parsed);
            return true;
          } catch (err) {
            console.warn("Could not load state from localStorage:", err);
            return false;
          }
        }

        const PRESETS = {
          button: {
            small: { font: 13, padding: 6 },
            medium: { font: 16, padding: 10 },
            large: { font: 20, padding: 14 },
          },
          card: {
            small: { font: 14, padding: 8 },
            medium: { font: 16, padding: 16 },
            large: { font: 18, padding: 24 },
          },
          header: {
            small: { font: 16, padding: 8 },
            medium: { font: 20, padding: 12 },
            large: { font: 26, padding: 16 },
          },
        };

        function getPreset(component, size) {
          const tokenPreset = state.tokens.sizes[size];
          return tokenPreset ?? PRESETS[component][size];
        }

        function setRootVar(name, value) {
          document.documentElement.style.setProperty(name, value);
        }

        function applyTokensToPreview() {
          const root = document.getElementById("preview-area");
          const t = state.tokens;

          root.style.setProperty("--token-primary", t.primary);
          root.style.setProperty("--token-secondary", t.secondary);
          root.style.setProperty("--token-text", t.text);
          root.style.setProperty("--token-border-radius", px(t.radius));
          root.style.setProperty("--token-on-primary", t.text);
          root.style.setProperty("--token-on-secondary", t.text);
        }

        let state = {
          component: "button",
          variant: "primary",
          size: "medium",
          text: "",
          fontSizeAdjust: 0,
          paddingAdjust: 0,

          radius: 8,
          bgColor: "#4a78ff",
          textColor: "#ffffff",

          overrides: {
            radius: false,
            bgColor: false,
            textColor: false,
            fontSize: false,
            padding: false,
          },

          fontFamily: "system-ui",
          animation: "none",

          tokens: {
            primary: "#4a78ff",
            secondary: "#335bef",
            text: "#ffffff",
            radius: 8,

            sizes: {
              small: { font: 13, padding: 6 },
              medium: { font: 16, padding: 10 },
              large: { font: 20, padding: 14 },
            },
          },
        };

        let history = [];
        let historyIndex = -1;

        function recordState() {
          history = history.slice(0, historyIndex + 1);
          history.push(deepCopy(state));
          historyIndex++;
          updateUndoRedoButtons();
          saveStateToStorage();
        }

        function undo() {
          if (historyIndex <= 0) return;
          historyIndex--;
          state = deepCopy(history[historyIndex]);
          renderFromState();
          updateUndoRedoButtons();
        }

        function redo() {
          if (historyIndex >= history.length - 1) return;
          historyIndex++;
          state = deepCopy(history[historyIndex]);
          renderFromState();
          updateUndoRedoButtons();
        }

        function updateUndoRedoButtons() {
          undoBtn.disabled = historyIndex <= 0;
          redoBtn.disabled = historyIndex >= history.length - 1;
        }

        function createButton({ text, variant, size }) {
          const btn = document.createElement("button");
          btn.className = `preview-button preview-component ${variant} size-${size}`;
          btn.textContent = text || "Text";
          return btn;
        }

        function createCard({ text, variant, size }) {
          const card = document.createElement("div");
          card.className = `preview-card preview-component ${variant} size-${size}`;
          const h = document.createElement("h3");
          h.textContent = text || "Title";
          const p = document.createElement("p");
          p.textContent = "Example content";
          card.append(h, p);
          return card;
        }

        function createHeader({ text, variant, size }) {
          const h = document.createElement("header");
          h.className = `preview-header preview-component ${variant} size-${size}`;
          h.textContent = text || "Heading";
          return h;
        }

        function hexToRgb(hex) {
          const h = hex.replace("#", "");
          if (h.length === 3) {
            return [
              parseInt(h[0] + h[0], 16),
              parseInt(h[1] + h[1], 16),
              parseInt(h[2] + h[2], 16),
            ];
          }
          return [
            parseInt(h.slice(0, 2), 16),
            parseInt(h.slice(2, 4), 16),
            parseInt(h.slice(4, 6), 16),
          ];
        }

        function getLuminance(rgb) {
          const srgb = rgb
            .map((v) => v / 255)
            .map((v) =>
              v <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4)
            );
          return 0.2126 * srgb[0] + 0.7152 * srgb[1] + 0.0722 * srgb[2];
        }

        function getContrastRatio(hex1, hex2) {
          const lum1 = getLuminance(hexToRgb(hex1));
          const lum2 = getLuminance(hexToRgb(hex2));
          const brightest = Math.max(lum1, lum2);
          const darkest = Math.min(lum1, lum2);
          return (brightest + 0.05) / (darkest + 0.05);
        }

        function updateContrastWarning() {
          const warningEl = document.getElementById("contrast-warning");
          const bg = state.overrides.bgColor
            ? state.bgColor
            : state.tokens.primary;
          const text = state.overrides.textColor
            ? state.textColor
            : state.tokens.text;
          const ratio = getContrastRatio(bg, text);

          if (ratio < 2) {
            warningEl.textContent = `⚠️ Low contrast between text and background. Text may be hard to read.`;
          } else {
            warningEl.textContent = "";
          }
        }

        function renderFromState() {
          compSelect.value = state.component;
          compVariant.value = state.variant;
          compSize.value = state.size;

          const preset = getPreset(state.component, state.size);

          propText.value = state.text;

          const effectiveFontSize = preset.font + state.fontSizeAdjust;
          const effectivePadding = preset.padding + state.paddingAdjust;

          propFontSize.value = effectiveFontSize;
          propPadding.value = effectivePadding;

          fontSizeValue.textContent = px(effectiveFontSize);
          paddingValue.textContent = px(effectivePadding);

          const effectiveRadius = state.overrides.radius
            ? state.radius
            : state.tokens.radius;

          propRadius.value = effectiveRadius;
          radiusValue.textContent = px(effectiveRadius);

          propFontFamily.value = state.fontFamily;

          propAnimation.value = state.animation;

          propBgColor.value = state.bgColor;

          const effectiveTextColor = state.overrides.textColor
            ? state.textColor
            : state.tokens.text;

          propTextColor.value = effectiveTextColor;

          tokenPrimary.value = state.tokens.primary;
          tokenSecondary.value = state.tokens.secondary;
          tokenText.value = state.tokens.text;

          tokenRadius.value = state.tokens.radius;
          tokenRadiusValue.textContent = px(state.tokens.radius);

          tokenSizeSmallFont.value = state.tokens.sizes.small.font;
          tokenSizeSmallFontValue.textContent = px(
            state.tokens.sizes.small.font
          );
          tokenSizeSmallPad.value = state.tokens.sizes.small.padding;
          tokenSizeSmallPadValue.textContent = px(
            state.tokens.sizes.small.padding
          );

          tokenSizeMediumFont.value = state.tokens.sizes.medium.font;
          tokenSizeMediumFontValue.textContent = px(
            state.tokens.sizes.medium.font
          );
          tokenSizeMediumPad.value = state.tokens.sizes.medium.padding;
          tokenSizeMediumPadValue.textContent = px(
            state.tokens.sizes.medium.padding
          );

          tokenSizeLargeFont.value = state.tokens.sizes.large.font;
          tokenSizeLargeFontValue.textContent = px(
            state.tokens.sizes.large.font
          );
          tokenSizeLargePad.value = state.tokens.sizes.large.padding;
          tokenSizeLargePadValue.textContent = px(
            state.tokens.sizes.large.padding
          );

          applyTokensToPreview();

          previewArea.innerHTML = "";
          let el;

          if (state.component === "button") {
            el = createButton(state);
          } else if (state.component === "card") {
            el = createCard(state);
          } else {
            el = createHeader(state);
          }

          el.style.setProperty("--font-size-base", px(preset.font));
          el.style.setProperty("--padding-y-base", px(preset.padding));
          el.style.setProperty("--padding-x-base", px(preset.padding));

          el.style.setProperty("--font-size-adjust", px(state.fontSizeAdjust));
          el.style.setProperty("--padding-adjust", px(state.paddingAdjust));
          el.style.fontFamily = state.fontFamily;

          el.classList.remove(
            "anim-hover-scale",
            "anim-hover-fade",
            "anim-hover-lift",
            "anim-press-scale"
          );

          if (state.animation !== "none") {
            el.classList.add(`anim-${state.animation}`);
          }

          if (state.overrides.radius) {
            el.style.setProperty("--component-border-radius", px(state.radius));
          } else {
            el.style.removeProperty("--component-border-radius");
          }

          if (state.overrides.bgColor) {
            el.style.setProperty("--component-bg", state.bgColor);
          } else {
            el.style.removeProperty("--component-bg");
          }

          if (state.overrides.textColor) {
            el.style.setProperty("--component-text", state.textColor);
          } else {
            el.style.removeProperty("--component-text");
          }

          previewArea.appendChild(el);

          updateContrastWarning();
        }

        function exportCSS() {
          const t = state.tokens;
          const overrides = {
            "--component-font-family": state.fontFamily,
            "--component-font-size":
              PRESETS[state.component][state.size].font +
              state.fontSizeAdjust +
              "px",
            "--component-padding":
              PRESETS[state.component][state.size].padding +
              state.paddingAdjust +
              "px",
          };
          if (state.overrides.radius)
            overrides["--component-border-radius"] = state.radius + "px";
          if (state.overrides.bgColor)
            overrides["--component-background-color"] = state.bgColor;
          if (state.overrides.textColor)
            overrides["--component-text-color"] = state.textColor;

          let css = ":root {\n";
          css += `  --token-primary: ${t.primary};\n`;
          css += `  --token-secondary: ${t.secondary};\n`;
          css += `  --token-text: ${t.text};\n`;
          css += `  --token-border-radius: ${t.radius}px;\n`;
          css += `  --token-font-small: ${t.sizes.small.font}px;\n`;
          css += `  --token-padding-small: ${t.sizes.small.padding}px;\n`;
          css += `  --token-font-medium: ${t.sizes.medium.font}px;\n`;
          css += `  --token-padding-medium: ${t.sizes.medium.padding}px;\n`;
          css += `  --token-font-large: ${t.sizes.large.font}px;\n`;
          css += `  --token-padding-large: ${t.sizes.large.padding}px;\n`;

          for (const key in overrides) {
            css += `  ${key}: ${overrides[key]};\n`;
          }
          css += "}";

          if (state.animation !== "none") {
            css += `\n\n/* Requires animation preset: .anim-${state.animation} */`;
          }

          navigator.clipboard.writeText(css).then(() => alert("CSS copied!"));
        }

        function exportJSON() {
          const preset = PRESETS[state.component][state.size];
          const computedFontSize = preset.font + state.fontSizeAdjust;
          const computedPadding = preset.padding + state.paddingAdjust;

          const exportData = {
            component: state.component,
            variant: state.variant,
            size: state.size,
            text: state.text,
            fontFamily: state.fontFamily,
            animation: state.animation !== "none" ? state.animation : null,
            fontSize: computedFontSize + "px",
            padding: computedPadding + "px",
            radius: state.radius,
            bgColor: state.bgColor,
            textColor: state.textColor,
            tokens: state.tokens,
          };

          navigator.clipboard
            .writeText(JSON.stringify(exportData, null, 2))
            .then(() => alert("JSON copied!"));
        }

        function attachListeners() {
          [compSelect, compVariant].forEach((el) =>
            el.addEventListener("change", () => {
              state.component = compSelect.value;
              state.variant = compVariant.value;
              recordState();
              renderFromState();
            })
          );

          propText.addEventListener("input", () => {
            state.text = propText.value;
            recordState();
            renderFromState();
          });

          propRadius.addEventListener("input", () => {
            state.radius = propRadius.valueAsNumber;
            state.overrides.radius = true;
            radiusValue.textContent = px(state.radius);
            recordState();
            renderFromState();
          });

          propFontFamily.addEventListener("input", () => {
            state.fontFamily = propFontFamily.value;
            recordState();
            renderFromState();
          });

          propAnimation.addEventListener("change", () => {
            state.animation = propAnimation.value;
            recordState();
            renderFromState();
          });

          propBgColor.addEventListener("input", () => {
            state.bgColor = propBgColor.value;
            state.overrides.bgColor = true;
            recordState();
            renderFromState();
          });

          propTextColor.addEventListener("input", () => {
            state.textColor = propTextColor.value;
            state.overrides.textColor = true;
            recordState();
            renderFromState();
          });

          propFontSize.addEventListener("input", () => {
            const base = getPreset(state.component, state.size).font;

            state.fontSizeAdjust = propFontSize.valueAsNumber - base;
            state.overrides.fontSize = true;

            recordState();
            renderFromState();
          });

          propPadding.addEventListener("input", () => {
            const base = getPreset(state.component, state.size).padding;

            state.paddingAdjust = propPadding.valueAsNumber - base;
            state.overrides.padding = true;

            recordState();
            renderFromState();
          });

          compSize.addEventListener("change", () => {
            state.size = compSize.value;

            state.overrides.fontSize = false;
            state.overrides.padding = false;
            state.fontSizeAdjust = 0;
            state.paddingAdjust = 0;

            const preset = getPreset(state.component, state.size);

            propFontSize.value = preset.font;
            propPadding.value = preset.padding;

            recordState();
            renderFromState();
          });

          tokenPrimary.addEventListener("input", () => {
            state.tokens.primary = tokenPrimary.value;
            recordState();
            renderFromState();
          });

          tokenSecondary.addEventListener("input", () => {
            state.tokens.secondary = tokenSecondary.value;
            recordState();
            renderFromState();
          });

          tokenText.addEventListener("input", () => {
            state.tokens.text = tokenText.value;
            recordState();
            renderFromState();
          });

          tokenRadius.addEventListener("input", () => {
            state.tokens.radius = tokenRadius.valueAsNumber;
            tokenRadiusValue.textContent = px(state.tokens.radius);
            recordState();
            renderFromState();
          });

          tokenSizeSmallFont.addEventListener("input", () => {
            const v = tokenSizeSmallFont.valueAsNumber;
            state.tokens.sizes.small.font = v;
            tokenSizeSmallFontValue.textContent = px(v);
            recordState();
            if (!state.overrides.fontSize) renderFromState();
          });

          tokenSizeMediumFont.addEventListener("input", () => {
            const v = tokenSizeMediumFont.valueAsNumber;
            state.tokens.sizes.medium.font = v;
            tokenSizeMediumFontValue.textContent = px(v);
            recordState();
            if (!state.overrides.fontSize) renderFromState();
          });

          tokenSizeLargeFont.addEventListener("input", () => {
            const v = tokenSizeLargeFont.valueAsNumber;
            state.tokens.sizes.large.font = v;
            tokenSizeLargeFontValue.textContent = px(v);
            recordState();
            if (!state.overrides.fontSize) renderFromState();
          });

          tokenSizeSmallPad.addEventListener("input", () => {
            const v = tokenSizeSmallPad.valueAsNumber;
            state.tokens.sizes.small.padding = v;
            tokenSizeSmallPadValue.textContent = px(v);
            recordState();
            if (!state.overrides.padding) renderFromState();
          });

          tokenSizeMediumPad.addEventListener("input", () => {
            const v = tokenSizeMediumPad.valueAsNumber;
            state.tokens.sizes.medium.padding = v;
            tokenSizeMediumPadValue.textContent = px(v);
            recordState();
            if (!state.overrides.padding) renderFromState();
          });

          tokenSizeLargePad.addEventListener("input", () => {
            const v = tokenSizeLargePad.valueAsNumber;
            state.tokens.sizes.large.padding = v;
            tokenSizeLargePadValue.textContent = px(v);
            recordState();
            if (!state.overrides.padding) renderFromState();
          });

          exportCSSBtn.addEventListener("click", exportCSS);
          exportJSONBtn.addEventListener("click", exportJSON);
          undoBtn.addEventListener("click", undo);
          redoBtn.addEventListener("click", redo);

          resetBtn.addEventListener("click", () => {
            const comp = state.component;
            const variant = state.variant;
            const size = state.size;
            const tokens = deepCopy(state.tokens);

            state = deepCopy(history[0]);
            state.component = comp;
            state.variant = variant;
            state.size = size;
            state.tokens = tokens;

            state.overrides.fontSize = false;
            state.overrides.padding = false;

            renderFromState();
            recordState();
          });

          clearAllBtn.addEventListener("click", () => {
            const confirmed = confirm(
              "Resetting all settings will restore the default configuration and permanently remove all user customizations. Do you wish to continue?"
            );
            if (!confirmed) return;

            localStorage.removeItem(STORAGE_KEY);

            state = {
              component: "button",
              variant: "primary",
              size: "medium",
              text: "",
              fontSizeAdjust: 0,
              paddingAdjust: 0,

              radius: 8,
              bgColor: "#4a78ff",
              textColor: "#ffffff",

              overrides: {
                radius: false,
                bgColor: false,
                textColor: false,
                fontSize: false,
                padding: false,
              },

              fontFamily: "system-ui",
              animation: "none",

              tokens: {
                primary: "#4a78ff",
                secondary: "#335bef",
                text: "#ffffff",
                radius: 8,
                sizes: {
                  small: { font: 13, padding: 6 },
                  medium: { font: 16, padding: 10 },
                  large: { font: 20, padding: 14 },
                },
              },
            };

            history = [deepCopy(state)];
            historyIndex = 0;

            renderFromState();
            updateUndoRedoButtons();
          });
        }

        function init() {
          loadStateFromStorage();
          history = [deepCopy(state)];
          historyIndex = 0;
          attachListeners();
          renderFromState();
          updateUndoRedoButtons();
        }

        init();
      })();
    </script>
  </body>
</html>
